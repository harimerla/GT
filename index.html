<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
                           integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
                           crossorigin="anonymous"> -->

    <title>WebGPU Webpack Starter</title>
    <!-- <link rel="stylesheet" href="bootstap/css/bootstrap.min.css" type="text/html"> -->
    <script src="js/jquery_3.5.1_jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/ag-grid-community.min.noStyle.js"></script>
    <link rel="stylesheet" href="css/rangesliderstyle.css" />
    <script src="js/rangeslider.umd.min.js"></script>
    <link
      rel="stylesheet"
      href="css/ag-grid.min.css"
      content-type="text/css" type="text/css"
    /> 
    <link
      rel="stylesheet"
      href="css/ag-theme-alpine.min.css"
      content-type="text/css" type="text/css"
    />
    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" type="text/html"> -->
  <link rel="stylesheet" href="css/jquery-ui.css" type="text/css">
  <link rel="stylesheet" href="css/style.css", type="text/css">
  <link rel="stylesheet" href="css/bootstrap.min.css", type="text/css">
  <link rel="stylesheet" href="css/bootstrap-multiselect.css">
  <script src = "js/bootstrap-multiselect.min.js"></script>
  <script src="js/popper.min.js"></script>
  <script src="js/multiselect-dropdown.js" ></script>
  <script src="js/plotly-latest.min.js"></script>
  <!-- <link rel="stylesheet" href="css/multi-select-tag.css" type="text/css"> -->
    </script>
</head>
<body class="p-3 mb-2 bg-secondary text-white">
    <!-- <div class="container" style="width: 100%;"> -->
        <div id="container" class="container-fluid w-90 p-3 mb-2 bg-dark text-white">
            <div id="filterDiv" class="p-3 mb-2 bg-secondary text-white">
                <!-- file upload -->
                <div id="filters div" class="container">
                    <h3>Filters</h3>
                    <br>
                    <div style="display:none">
                        <label for="expression">Choose Expression File</label>
                        <input type="file" name="Expression" id="expression">
                    </div>
                    <div style="display:none">
                        <label for="layout">Choose Layout File</label>
                        <input type="file" name="Layout" id="layout">
                    </div>
                    <div id="chooseDiv">
                    <label for="patient">Choose Cancer Type</label><br>
                         <select name="patient" id="patient">
                            <option value="GBM">GBM</option>
                            <option value="Breast">BRCA</option>
                            <option value="Breast">COAD</option>
                            <option value="Breast">UCEC</option>
                            <option value="Breast">KIRC</option>
                            <option value="Breast">LUAD</option>
                            <option value="Breast">LUSC</option>
                        </select>
                    </div>
                        <br>
                    <!-- <div>
                        <label for="patient">Choose Patient</label>
                         <select name="patient" id="patient">
                            <option value="select">select</option>
                            <option value="0">0</option>
                            <option value="1">1</option>
                        </select>
                        <input type="text" id="patient" value="0">
                    </div>-->
                    <div id="sigma_div">
                        <label for="sigma_range" class="form-label">Sigma range (0, 1)</label><br>
                        <input type="range" class="form-range" min="0" max="1" step="0.05" id="sigma_range" value="0.5" oninput="this.nextElementSibling.value = this.value">
                        <!-- <input type="text" class="form-range" min="0" max="1" step="0.05" id="sigma_range" value="1" oninput="this.nextElementSibling.value = this.value"> -->
                        <output>0.5</output>
                    </div>
                    <br>
                    <div style="margin-bottom:10px"><Output>Scale (-20, 20)</Output></div>
                    <div class="parentScale" id="parentScale">
                        <output id="minText">-3</output>
                        <div id="range-slider-example" class="scale">
                        </div>
                        <output id="maxText">3</output>
                    </div>
                    <script>rangeSlider(document.querySelector('#range-slider-example'),{
                        min:-20,
                        max:20,
                        step:1,
                        value: [-3,3],
                        onInput: function(valueset){
                            var minText = document.getElementById('minText')
                            var maxText = document.getElementById('maxText')
                            minText.value=+valueset[0];
                            maxText.value=+valueset[1];
                            console.log(minText.value)
                        }
                    });</script>
                    <div>
                        <!-- <label for="scale-min" class="form-label">Scale Min</label>
                        <input type="range" id="scale-min" min="-10" max="0" step="0.5" value="-10" oninput="this.nextElementSibling.value = this.value">
                        <output>-10</output>
                        <br>
                        <label for="scale-max" class="form-label">Scale Max</label>
                        <input type="range" id="scale-max" min="0" max="10" step="0.5" value="0" oninput="this.nextElementSibling.value = this.value">
                        <output>0</output> -->
                        <!-- <div style="width: 50%;float:left;" id="scale_min_div">
                            <label style="margin:auto">Scale Min</label>
                            <div>
                            <output id="scaleMinOutput">-3</output>
                            <input class="multi-range" min="-10" max="0" step="1" type="range" value="-3" id="scale-min" oninput="document.getElementById('scaleMinOutput').value = this.value"/>
                            </div>
                        </div>
                        <div style="margin-left: 50%;" id="scale_max_div">
                            <label style="margin: auto;">Scale Max</label>
                            <input class="multi-range" min="0" max="10" step="1" type="range" value="3" id="scale-max" oninput="this.nextElementSibling.value = this.value"/>
                            <output>3</output>
                        </div> -->
                        <!-- multi slider -->
                        <!-- <div class="slider"></div>
                        <script>
                            let slider = new RangeSlider('.slider',{min:-10,max:10,values:[-10,10],pointRadius:10});
                            console.log(sigmaWidth);
                        </script> -->
                        <!-- <div class="middle">
                            <div class="multi-range-slider">
                                <input type="range" id="input-left" min="0" max="100" value="25">
                                <input type="range" id="input-right" min="0" max="100" value="75">
                        
                                <div class="slider">
                                    <div class="track"></div>
                                    <div class="range"></div>
                                    <div class="thumb left"></div>
                                    <div class="thumb right"></div>
                                </div>
                            </div>
                        </div> -->
                        <!-- multi slider -->

                        <!-- <div id="slider" class="multi-range"></div>
                        <script src="jquery-3.5.1.min.js"></script>
                        <script src="jquery-ui_latest.js"></script>
                        <script>
                            $(function() {
                              $("#slider").slider({
                                range: true,
                                min: 0,
                                max: 100,
                                values: [25, 75],
                                slide: function(event, ui) {
                                  // Display the slider values
                                  $("#sliderValues").text(ui.values[0] + " - " + ui.values[1]);
                                }
                              });
                            });
                    
                            function getSliderValues() {
                              var sliderValues = $("#slider").slider("values");
                              console.log("Slider Values:", sliderValues);
                            }
                          </script> -->
                        <a href="#" id="a1" style="display:none"></a>
                        <a href="#" id="a2" style="display:none"></a>
                        <a href="#" id="a3" style="display:none"></a>
                    </div>
                    <br>
                    <div id="pixelDiv">
                        <label for="pixel">Resolution (100, 1000)</label><br>
                        <input type="range" id="pixel" min="100" max="1000" value="250" step="50" oninput="this.nextElementSibling.value = this.value">
                        <output>250</output>
                    </div>
                    <br>
                    <div id="showgene_div" style="display: none">
                        <label for="show gene" class="form-label">Show Gene</label>
                        <input type="checkbox" id="show gene">
                    </div>
                    <br>
                    <!-- <select class="select" multiple data-mdb-filter="true"> -->
                        <div>
                            <label>Select Gene/Genes</label><br>
                            <!-- <select id="selectGene" name="field1" multiple onchange="console.log(Array.from(this.selectedOptions).map(x=>x.value??x.text))" multiselect-hide-x="false"> -->
                            <select name="field2" style="color:black" id="selectGene" multiple multiselect-search="true" multiselect-select-all="true" multiselect-max-items="3" onchange="console.log(this.selectedOptions)">
                            <!-- <option value="sult4a1">sult4a1</option>
                            <option value="cyp46a1">cyp46a1</option>
                            <option value="anxa5">anxa5</option>
                            <option value="nmnat2">nmnat2</option>
                            <option value="palm">palm</option>
                            <option value="cd48">cd48</option> -->
                            </select>
                        </div><br>
                    <div id='myDiv'><!-- Plotly chart will be drawn inside this DIV --></div>
                    <div>
                        <input type="submit" value="Generate" id="Generate" class="btn btn-primary">
                    </div>
                </div>
            </div>
            <div id="plotDiv">
            <div class="col-12 text-center">
                <div id="myGrid" class="ag-theme-alpine" style="width: 800px; overflow: auto;"></div>
                <br><br><br><br>
                <div id="navDiv">
                    <nav>
                        <div class="nav nav-tabs" id="nav-tab" role="tablist">
                          <button class="nav-link active" id="nav-GT-tab" data-bs-toggle="tab" data-bs-target="#nav-home" type="button" role="tab" aria-controls="nav-home" aria-selected="true">Specific</button>
                          <button class="nav-link" id="nav-Sigma-tab" data-bs-toggle="tab" data-bs-target="#nav-profile" type="button" role="tab" aria-controls="nav-profile" aria-selected="false">Sigma</button>
                          <button class="nav-link" id="nav-Avg-tab" data-bs-toggle="tab" data-bs-target="#nav-contact" type="button" role="tab" aria-controls="nav-contact" aria-selected="false">Tab1</button>
                        </div>
                      </nav>
                      <div class="tab-content" id="nav-tabContent">
                        <div class="tab-pane fade show active" id="nav-GT" role="tabpanel" aria-labelledby="nav-GT-tab">
                            <div id="canvas-div" style="width: 720; height: 720;"></div>
                            <div id="download image div1" style="margin-left: 200px;">
                                <input type="button" class="btn btn-primary" value="Download Image" id="download-image1" style="display:none">
                            </div>
                            <div id="canvas-contour-div" style="width: 720; height: 720;"></div>
                            <div id="download image div2" style="margin-left: 200px;">
                                <input type="button" class="btn btn-primary" value="Download Image" id="download-image2" style="display:none">
                            </div>
                            </div>
                        <div class="tab-pane fade" id="nav-Sigma" role="tabpanel" aria-labelledby="nav-Sigma-tab">
                            <div id="canvas-div1" style="width: 720; height: 720;"></div>
                            <div id="download image div3" style="margin-left: 200px;">
                                <input type="button" class="btn btn-primary" value="Download Image" id="download-image3" style="display:none">
                            </div>
                        </div>
                        <div class="tab-pane fade" id="nav-Avg" role="tabpanel" aria-labelledby="nav-Avg-tab">
                            <div id="canvas-div01" style="width: 720; height: 720;"></div>
                            <br>
                            <div id="bar-chart-exp"></div>
                            <br>
                            <div id="bar-chart-output"></div>
                            <div id="canvas-div02" style="width: 720; height: 720;"></div>
                            <div id="canvas-div03" style="width: 720; height: 720;"></div>
                            <div id="canvas-div04" style="width: 720; height: 720;"></div>
                        </div>
                    </div>
                      </div>
                </div>
                <br>
                <script type="module">
                    var graphDiv = document.getElementById('canvas-div01');
                    graphDiv.addEventListener('mouseenter', ()=>{
                        graphDiv.on('plotly_selected',function(eventData){
                        console.log(eventData);
                        // console.log(eventData.currentTarget.data[1].selectedpoints)
                        // console.log(eventData.currentTarget.data[1].selectedpoints[0].x)
                        var pt=[]
                        var ptx=[], pty=[], pttext=[], ptout=[], ptexp=[], ptbase=[], ptcolorexp=[], ptcolorGT=[], ptoutText=[], ptexpText=[]
                        eventData.points.forEach(function(pt) {
                            ptx.push(pt.x);
                            pty.push(pt.y);
                            var currOut = pt.data.args.z[~~(pt.y)][~~(pt.x)]
                            var currExp = pt.data.args.exp[pt.text]
                            ptout.push(currOut)
                            ptoutText.push(Number(currOut).toFixed(2))
                            pttext.push(pt.text);
                            ptexp.push(currExp)
                            ptexpText.push(Number(currExp).toFixed(2))
                            // ptbase.push(currOut<0?currOut:0)
                            ptcolorexp.push(currExp<0?'blue':'orange')
                            ptcolorGT.push(currOut<0?'blue':'orange')
                            console.log(pt.x);
                            console.log(pt.y);
                            console.log(pt.text);
                        });
                        var barTraceOuput = [{
                            x: pttext,
                            y: ptout,
                            type: 'bar',
                            base: 0,
                            text: ptoutText.map(String),
                            textposition: 'auto',
                            hoverinfo: 'none',
                            width: 0.5,
                            // text: pttext,
                            marker: {color: ptcolorGT}
                        }];
                        var barTraceExp = [{
                            x: pttext,
                            y: ptexp,
                            type: 'bar',
                            base: 0,
                            text: ptexpText.map(String),
                            textposition: 'auto',
                            hoverinfo: 'none',
                            width: 0.5,
                            // text: pttext,
                            marker: {color: ptcolorexp}
                        }];
                        var plotLayout = {
                            width:512,
                            height:512,
                            showlegend: true,
                            legend: {
                                x: 0.8,
                                // xanchor: 'right',
                                y: 1.05,
                                bgcolor: 'E2E2E2'
                            },
                            font:{
                                color:"black",
                                size:12,
                            }
                            }
                        var barsLayout1 = JSON.parse(JSON.stringify(plotLayout));
                        barsLayout1['title']={
                            text:'<br>Gene vs Exp',
                            font: {
                            size: 24,
                            color: '#7f7f7f'
                            },
                            xref: 'paper',
                        }
                        var barsLayout2 = JSON.parse(JSON.stringify(plotLayout));
                        barsLayout2['title']={
                            text:'<br>Gene vs GT',
                                font: {
                                size: 24,
                                color: '#7f7f7f'
                                },
                                xref: 'paper',
                        }
                        
                        Plotly.newPlot('bar-chart-exp',barTraceExp, barsLayout1);
                        Plotly.newPlot('bar-chart-output',barTraceOuput, barsLayout2);
                        })
                    })
                </script>
                <canvas id="webgpu-canvas" class="img-fluid" width="720" height="512" style="display:none"></canvas>
                </div>
            <div class="col-12 alert alert-danger" id="no-webgpu" style="display:none;">
                    <h4>Error: Your browser does not support WebGPU</h4>
                    <p>You can find out how to get access to it in Chrome Canary
                    <a href="https://web.dev/gpu/#use">here</a>.</p>
            </div>
            </div>
        <!-- </div> -->
    
</body>
</html>

